# Part 01. 코드 정리법

종종 사람들이 '리팩터링'을 적용하는 동안에는 기능 개발을 멈추는 것으로 오해했기 때문에 치명적 피해를 끼쳤습니다.  
'리팩터링' 때문에 아쉽게 시스템 장애를 일으키기도 했습니다.  

## Chapter 01. 보호 구문

처음 두 줄을 도우미 메서드로 추출한 다음에 보호 구문으로 코드를 정리할 수도 있지만, 항상 그리고 반드시 작은 단계를 거쳐 코드를 정리하세요.  

> early return으로 조건문 복잡도 풀기  
> 
> if 문이 많아진다면 별도 유스케이스(클래스)로 추출하는 것을 고려해야 함  
> if 문 때문에 케이스별 테스트 코드 작성이 어려워짐  


## Chapter 02. 안 쓰는 코드

실행되지 않는 코드라면 그냥 지웁니다.  

때로는 안 쓰는 코드 찾기가 쉬울 수도 있지만, 더러는 쉽지 않을 때도 있습니다.  
리플렉션을 여러 번 사용한 코드가 그렇습니다.  

형상 관리 도구가 해결해 줍니다.  

항상 그렇듯이 각 정리 과정에서는 코드를 '조금만' 삭제하세요.  
조건 내용을 택하여 true로 줄일 수 있고, 루틴 하나, 파일 하나, 디렉토리 하나 정도로 해 나갈 수 있습니다.  

> 안 쓰는 코드 제거하는건 개발자마다 성향, 책임감 차이인 듯  
> 테스트 코드도 충분히 존재해야 함  
> 
> 코드가 많아지면 IDE 여는게 느려짐  
> 레거시 코드는 IDE에서 열리지 않아 Visual Studio로 열어본 경험이 있음  


## Chapter 03. 대칭으로 맞추기

코드는 마치 유기체처럼 성장합니다.  

코드가 유기체로 성장하면, 같은 문제라도 시대와 사람에 따라 다른 모습으로 해결됩니다.  
이것은 코드를 읽기 어렵게 만들기도 합니다.  

한가지 패턴의 코드는 읽다 보면 그 방식에 금방 익숙해집니다.  
두 가지 이상의 패턴을 섞어 쓰면 혼란스러워집니다.  

한 가지 방식을 선택해서 정합니다.  
다른 방식으로 작성한 코드를 선택한 방식으로 고칩니다.  

> 코드뿐만 아니라 아키텍처에도 해당하는 내용이라 생각됨  
> 단일 모듈에 패키지 구조와 클래스 suffix가 명확하지 않은 프로젝트를 접했을 때 어떻게 작업해야할지 혼란스러운 경험이 있음  
> 프로젝트 오너와 얘기하면서 맞춰 나감  
> Archunit의 중요성을 다시 한번 느낌  
>
> 프로젝트 오너는 본인이 담당하는 서비스의 아키텍처를 명확하게 정의할 필요가 있다고 생각함  

## Chapter 04. 새로운 인터페이스로 기존 루틴 부르기

루틴을 호출해야 하는데 기존 인터페이스 때문에 어렵거나, 복잡하거나, 혼란스럽거나, 지루해지곤 합니다.  
이 모든 경우에 호출하고 싶은 인터페이스를 새롭게 구현해서 호출하세요.  

- 거꾸로 코딩하기: 루틴의 마지막 줄부터 시작해 보세요. 이때는 마치 마지막 줄에 이르기까지 필요한 결과는 모두 확보한 듯이 짜는 거죠.

> 프록시 패턴?  
> 토스페이먼츠가 이런 방식으로 결제 API 스펙을 개선한걸로 알고 있음  


## Chapter 05. 읽는 순서

다른 코드 정리 작업을 함께 하고픈 유혹이 오더라도 뿌리치세요.  
읽어 가면서 이해나 변경을 어렵게 하는 세부 사항들도 주목했을 텐데, 나중에 이들을 정리할 때가 있습니다.  

되도록 전체 파일의 순서를 바꾸는 대신에, 읽는 순서가 영향을 크게 주는 것들부터 바꾸세요.  

> 레거시 시스템의 특징, 전통적으로 함수 최상위에 모든 변수를 선언하고, 로직을 풀어나감  
> 변수를 선언하는 위치와 사용하는 위치간 차이가 커서 종종 수정 함
>
> '다른 코드 정리 작업을 함께 하고픈 유혹이 오더라도 뿌리치세요.' 이 유혹을 뿌리치는 노하우가 있는지?  


## Chapter 06. 응집도를 높이는 배치

코드의 순서를 바꿔서 변경할 요소들을 가까이 두면 됩니다.  
두 루틴에 결합도가 있으면 서로 옆에 두세요.  
두 파일에 결합도가 있으면 같은 디렉토리에 넣습니다.  

결합도를 제거할 수 있다면 그렇게 하세요.  
`결합도 제거 비용 + 변경 비용 < 결합도에 따른 비용 + 변경 비용`

- 당장 어떻게 해야 할지 모를 경우
- 할 수 있지만, 시간적 여유가 없을 경우
- 팀이 이미 충분한 변경을 수행하고 있는 경우

스위스 치즈처럼 여기저기 코드가 구멍 난 듯 흩어진 채로 두고 동작 변경에만 매달리지 마세요.  

> 서비스 클래스와 DTO의 패키지 위치를 어떻게 구성하는지?  
> service 패키지 안에 서비스와 DTO 클래스를 모두 넣는지?  
> service 패키지와 dto 패키지를 구분하는지?  

