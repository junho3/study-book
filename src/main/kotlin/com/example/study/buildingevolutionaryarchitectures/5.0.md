# CHAPTER 5 진화하는 아키텍처 토폴로지

진화적 아키텍처는 커플링의 적정 수준에 주목한다.  
커플링을 맺을 아키텍처를 식별하고 최소한의 오버헤드와 비용을 들여 최대한의 이득을 볼 수 있어야 한다.  


## 5.1 진화 가능한 아키텍처 구조


### 5.1.1 동조성

한 컴포넌트를 변경했을 때 시스템의 전반적인 정확성을 유지하기 위해 다른 컴포넌트를 수정해야 한다면 두 컴포넌트는 동조적이다.  

본질적으로 동조성은 커플링을 세련되게 묘사한 언어일 뿐이지만 기술 리더와 개발자에게 커플링의 개념을 설명하기에는 더 좋은 언어다.  


#### 정적 동조성

정적 동조성은 소스 코드 수준에서 발생  
정적 동조성은 구조 설계에 정의된 구심 및 원심 커플링을 세분화한 개념이다.  
아키텍트는 구심 또는 원심 커플링의 결합 정도에 따라 다음과 같이 정적 동조성을 구분한다.  

- 명칭 동조성: 복수의 컴포넌트가 특정 엔티티명에 동의한다.  
- 타입 동조성: 복수의 컴포넌트가 특정 엔티티 타입에 동의한다.  
- 의미 동조성, 관례 동조성: 복수의 컴포넌트가 특정 값의 의미에 동의한다. int TRUE = 1, FALSE = 0
- 위치 동조성: 복수의 컴포넌트가 특정 값의 순서에 동의한다. 메소드나 함수를 호출하는 파라미터 값과 관련이 있다.  
- 알고리즘 동조성: 복수의 컴포넌트가 특정 알고리즘에 동의한다. 서버와 클라이언트 양쪽에 정의하는 해싱 알고리즘이다.


#### 동적 동조성

동적 동조성은 런타임 시점에 호출을 분석해서 확인한다.  

- 실행 동조성: 실행 순서가 복수의 컴포넌트에 영향을 미친다.
- 시점 동조성: 실행 시점이 복수의 컴포넌트에 영향을 미친다. 동시에 실행되는 두 개의 스레드가 유발하는 경합 조건이다.  
- 값 동조성: 서로 관련된 여러 값이 함께 변경되어야 하는 경우 발생하는 동조성이다. DB가 분리된 상황에서 모든 DB에 값을 동일하게 유지해야한다.  
- 식별 동조성: 복수의 컴포넌트가 동일한 엔티티를 참조한다. 분산 대기열처럼 공용으로 쓰이는 데이터 구조를 변경하면 대기열을 공유하는 컴포넌트가 모두 영향을 받는다.


#### 동조성 속성

동조성은 아키텍트와 개발자에게 유용한 분석 도구이며 동조성의 일부 속성은 개발자의 현명한 조언자 역할을 한다.  


##### 강도

아키텍트와 개발자는 더 나은 동조성 유형을 향해 리팩터링을 반복하며 코드베이스의 커플링 특성을 개선해야 한다.  
개발자는 소스 코드를 분석해 간단히 정적 동조성을 검사할 수 있으며 최신 개발 도구로 손쉽게 개선할 수 있기 때문이다.  
개발자는 소스 코드에서 의미만 있고 이름이 없는 마법의 값을 찾아 명명된 상수 타입으로 고칠 수 있다.  
의미 동조성을 명칭 동조성으로 리팩터링하는 사례다.  


##### 지역성

동조성의 지역성은 코드베이스 내부 모듈의 인접도를 나타낸다.  
하나의 모듈 안에서 서로 인접한 코드는 별도 모듈 또는 코드베이스로 떨어져 있는 코드보다 더 높은 동조성을 형성한다.  
동조성의 강도가 같다 해도 하나의 모듈에서 형성되는 것이 서로 다른 모듈에 나뉘어 있는 것보다 낫다.  

> 지난 카뱅 면접에서 AOP를 주제로 얘기했었음  
> 도메인 이벤트를 서비스 클래스에서 직접 발행할 것인가?  
> AOP를 사용해서 서비스 클래스에서 숨길 것인가?  
> 
> 서비스 클래스와 도메인 이벤트는 강한 커플링을 갖고 있음  
> 서비스 클래스에서 도메인 이벤트를 발행하게 되면 도메인 로직에 집중하기 어려울 것이고, AOP로 풀어야한다는 관점이 있음 https://supawer0728.github.io/2018/03/24/spring-event/  
> AOP로 풀게되면 서비스 클래스에 들어나지 않기 때문에 알 수가 없음  
> 
> 커플링에 대해 어떤 입장을 취할 것인가?  
> 책에서 소개한 지역성을 고려하면 서비스 클래스에서 직접 발행하는게 맞는 듯  


##### 정도

동조성의 정도느느 파급력과 관련이 있다.  
동조성의 정도가 낮을수록 동조성이 코드베이스에 가하는 손상의 정도도 낮다.  
코드베이스는 점점 덩치가 커지곤 한다.  
처음에는 사소했던 문제도 그에 따라 심각해지기 마련이다.  

페이지 존스의 3가지 지침  
- 시스템을 세부 요소로 쪼개고 각각을 캡슐화시켜 전체적인 동조성을 최소화한다.
- 캡슐화의 경계를 벗어나는 나머지 모든 동조성을 최소화한다.
- 캡슐화 경계 내부에서 동조성을 최대화한다.

짐 웨이리치의 2가지 조언
- 정도의 원칙: 강도 높은 동조성을 약한 동조성으로 변환하라
- 지역성의 원칙: 소프트웨어 요소 사이의 거리가 멀수록 약한 동조성을 사용하라


