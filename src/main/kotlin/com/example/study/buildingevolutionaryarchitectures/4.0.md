# CHAPTER 4 아키텍처 거버넌스 자동화

아키텍트의 임무는 소프트웨어 시스템의 구조를 설계하고 수많은 개발 원칙과 엔지니어링 관행을 정의하는 것이다.  
아키텍트는 소프트웨어 구축 과정을 관리하며 설계 원칙과 모범 사례를 따르고 알려진 시행착오를 방지해야 한다.  


## 4.1 피트니스 함수와 아키텍처 거버넌스

진화적 아키텍처의 메커니즘은 아키텍처 거버넌스, 특히 소프트웨어 엔지니어링 관행의 진화를 상징하는 거버넌스 자동화와 겹치는 부분이 많다는 사실이 밝혀졌다.  

테스트 커버리지가 높은 프로젝트일수록 코드의 품질이 높다는 공동의 경험은 테스트 주도 개발로 이어졌다.  

XP 개발자들은 그간의 프로젝트 경험을 통해 더 자주 통합할수록 문제도 줄어든다는 상관관계에 주목했으며, 이러한 인식을 지속적 통합이라는 개념으로 발전시켰다.  
지속적 통합 프로세스에서 모든 개발자는 적어도 하루에 한 번, 기본 코드베이스에 자신의 작업을 커밋한다.  

> 작게 자주 배포할수록 장애가 줄어드는 점에 동의함  
> 
> 하루에 1000번 배포하는 조직 되기  
> https://blog.banksalad.com/tech/become-an-organization-that-deploys-1000-times-a-day/

자동화는 통합의 핵심 조건일 뿐만 아니라 엔지니어링을 최적화하는 동력이기도 하다.  
2000년대 초에 일어난 데브옵스 혁명은 자동화의 이점을 다시 한번 절감하는 계기를 마련했다.  

지속적 통합은 점진적 변화를 이끌어낸다.  
이러한 점진적 변화가 피트니스 함수와 결합하면 다양한 방면에서 엔지니어링 관행의 진화가 일어난다.  

피트니스 함수는 저수준 코드 기반 분석에서 엔터프라이즈 아키텍처에 이르기까지 모든 아키텍처 측면에 존재한다.  


## 4.2 코드 기반 피트니스 함수

### 4.2.1 구심 및 원심 커플링

구심 커플링은 코드 아티팩트(컴포넌트, 클래스, 함수 등)로 들어오는 수신 연결 수를 측정하며 원심 커플링은 다른 코드 아티팩트로 나가는 발신 연결 수를 측정한다.  

이클립스 JDepend, InteliJ, 소나큐브와 같은 도구들로 컴포넌트의 관계를 분석하고 조회할 수 있다.  


### 4.2.2 추상도, 불안정도, 메인 시퀀스와의 거리

추상도는 구상 아티팩트(구현 클래스)에 대한 추상 아티팩트(추상 클래스, 인터페이스 등)의 비율이다.  
추상(abstract) vs 구현(implement)의 척도를 나타낸다.  
추상 요소는 개발자가 코드베이스의 전체 구조를 더 잘 이해하도록 돕는 특성이다.  
10,000줄짜리 main() 메소드 하나로 구성된 코드 베이스는 이 메트릭 수치가 거의 0에 가깝다.  

> 레거시 코드를 개선할 때 가장 먼저 하는게 의미가 있는 코드들을 private 메소드로 분리하여 main 메소드의 코드량을 덜어내는 것  
>
> 2023.08 인프콘 행사 '점진적 추상화'  
> https://www.inflearn.com/conf/infcon-2023/session-detail?id=767  
> 섣부른 추상화는 코드 복잡도를 올린다는 내용

불안정도 메트릭은 코드베이스의 변동성을 결정한다.  
높은 불안정도를 보이는 코드베이스는 커플링을 이루는 정도가 높으므로 변경 사항이 전체 구조를 깨뜨리기 쉽다.  

분석 결과를 구석으로 향하게 만든 덩치 큰 메서드를 찾아 부분적으로 추출하기 시작해 점진적으로 추상도를 높인다.  
추출된 코드 사이에서 능숙하게 중복 지점을 발견 및 제거하고 불안정도를 개선할 수 있을 것이다.  

아키텍트는 이러한 메트릭을 피트니스 함수로 활용해 코드베이스가 이 정도로 저하되지 않도록 처음부터 대비할 수 있다.  


### 4.2.3 임포트 방향성

컴포넌트 순환을 방지하려면 임포트 방향성을 관리해야 한다.  
JDepend는 자바 생태계에서 패키지의 커플링 특성을 분석하는 메트릭 도구다.  
만일 개발자가 persistence에서 util 패키지를 임포트하는 실수를 범하면 이 단위 테스트가 실패하므로 코드가 커밋되기 전에 발견할 수 있다.  

> 토스ㅣSLASH 22 - 지속 성장 가능한 코드를 만들어가는 방법  
> https://youtu.be/RVO02Z1dLF8?si=6Njd2uFgnbwAaxQo  


### 4.2.4 순환 복잡도와 '군집' 거버넌스

하나의 피트니스 함수에 엄격한 임곗값을 설정하는 방법도 있지만, 점점 더 나은 값을 향해 팀의 역량을 집중하는 방법도 있다.  
피트니스 함수를 연쇄적으로 구성하고 단계마다 상한성을 정해 경고를 발생시키는 방법도 있다.  

이러한 기법을 메트릭 기반 피트니스 함수 전반에 적용해 원하는 값에 근접하며 점진적으로 범위를 좁힐 수 있다.  
팀은 기술 부채를 해결한 이후에도 피트니스 함수를 그대로 유지할 것이며 향후 발생할 성능 저하까지 방지할 수 있다.  
이것이 바로 거버넌스를 통해 비트 부패를 방지하는 핵심이다.  


