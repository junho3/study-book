# 03 비기능적 요구사항

비기능적 요구사항
- 확장성
- 가용성
- 성능/지연 시간/P99과 처리량
- 내결함성
- 보안
- 프라이버시
- 정확성
- 일관성
- 비용
- 복잡성, 유지보수성, 디버깅 기능과 테스트 가능성

모든 시스템 설계 논의를 기능적 요구사항과 비기능적 요구사항 모두에 대한 설명과 명확하로 시작해야 한다.  
비기능적 요구사항은 일반적으로 서로 트레이드오프 된다.  

## 3.1 확장성

- 수직 스케일링
  - 일반적으로 4CPU * 1대 비용 > 1CPU * 4대 비용
  - 기술적 한계로 CPU, 램, 저장용량이 제한됨
  - 다운타임이 필요할 수 있음
- 수평 스케일링
  - 처리와 저장 요구사항을 여러 호스트에 분산

## 3.1.1 상태 비저장 서비스와 상태 저장 서비스

HTTP는 상태 비저장 프로토콜이므로 이를 사용하는 백엔드 서비스는 수평으로 쉽게 확장할 수 있다.  
공유 스토리지 쓰기는 호가장하기가 가장 어렵다.  

## 3.1.2 기본 로드밸런서 개념

일반적으로 서비스 요청은 로드 밸런서를 통해 서비스의 호스트로 라우팅된다고 본다.  

### 4계층 vs 7계층

- 4계층 로드 밸런서
  - 전송 계층(TCP)에서 작동
  - 패킷만 전달 가능
- 7계층 로드 밸런서
  - 응용 계층(HTTP)에서 작동
  - 로드밸런싱/라우팅 결정
  - 인증
  - TLS 종료(HTTPS -> HTTP)

### 고정 세션

고정 세션은 로드 밸런서가 특정 클라이언트의 요청을 로드 밸런서나 애플리케이션이 설정한 기간 동안 특정 호스트로 보내는 것을 말한다.  
고정 세션은 상태 저장 서비스에 사용된다.  

고정 세션은 기간 기반이나 애플리케이션 제어 쿠키를 사용해 구현할 수 있다.  

### 세션 복제

세션 복제에서는 호스트 쓰기가 같은 세션에 할당된 클러스터의 다른 여러 호스트에 복사되므로 해당 세션을 가진 어떤 호스트로도 읽기를 라우팅할 수 있다.  

이러한 호스트는 백업 링을 형성할 수 있다.  
쓰기 요청 > 호스트 A가 호스트 B에 씀 > 호스트 B가 호스트 C에 씀

### 로드밸런싱 vs 리버스 프록시

- 로드밸런싱
  - 확장성
- 리버스 프록시
  - 클라이언트 - 서버 통신 관리 기술
  - 서버로 들어오는 요청을 가로채고 전달
  - 캐싱과 압축 같은 성능 기능
  - SSL 종료와 같은 보안 기능


## 3.2 가용성

가용성은 시스템이 요청을 수락하고 원하는 응답을 반환할 수 있는 시간의 백분율이다.  

불필요한 복잡성 없이 높은 가용성을 허용하기 위해 다른 비기능적 요구사항을 트레이드오프할 수 있다.  

시스템의 비기능적 요구사항을 논의할 때 먼저 높은 가용성이 필요한지 확정해야 한다.  
높은 일관성과 낮은 지연 시간이 필요하다고 가정하지 말아야 한다.  
CAP 정리(일관성, 가용성, 분할 내성)를 참조하여 가용성을 높이기 위해 트레이드오프할 수 있는지 논의해본다.  

캐싱 서비스의 시스템 설계에서 더 낮은 지연 시간을 적용하기 위해 가용성을 트레이드오프하기로 결정할 수 있다.  



