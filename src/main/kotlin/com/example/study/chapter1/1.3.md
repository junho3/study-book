# 1.3 코드 품질의 핵심 요소

1. 코드는 읽기 쉬워야 한다.
2. 코드는 예측 가능해야 한다.
3. 코드를 오용하기 어렵게 만들라.
4. 코드를 모듈화하라.
5. 코드를 재사용 카능하고 일반화할 수 있게 작성하라.
6. **테스트가 용이한 코드를 작성하고, 제대로 테스트하라.**

> 테스트가 용이한 코드를 작성하면, 1~5번을 해결할 수 있다고 생각함  

## 1.3.1 코드는 읽기 쉬워야 한다

1. 코드가 하는 일
2. 어떻게 그 일을 수행하는지
3. (입력이나 상태 등) 어떤 것을 필요로 하는지
4. 코드 실행 결과물

> 퍼블릭 메소드에서는 어떤 행위만 하는지 알 수 있도록  
> 프라이빗 메소드에서는 행위의 세부 구현  
> 코틀린의 object 클래스를 활용하여 helper 클래스를 만들고, 퍼블릭 메소드로 구현하기도 함. 단위테스트 코드를 작성하기 위함  
```
class CancelPaymentService
  fun cancelPayment(param: Param) {
      findPayment(param.paymentId) // 결제건 조회
          .also { validateStatus(it.status) } // 결제건 상태 유효성 검증
          .also { validateBalanceAmount(it.money, param.money) } // 잔액과 취소금액 유효성 검증
          
      val response = callKakaopay(param.toRequest()) // 카카오페이 호출. dto 변환은 Param에 위임
  }
  
  private validateStatus(status: Status) { ... }
  private validateBalanceMoney(balanceMoney: Long, cancelMoney: Long) { ... }
  private callKakaopay(request: KakaopayRequest): KakaopayResponse { ... }
}

object CancelPaymentServiceHelper {
  fun validateStatus(status: Status) { ... }
}
```

## 1.3.2 코드는 예측 가능해야한다

코드의 사용자는 그 코드에 의해 일어날 일을 예상하지 않고 있기 때문에 그 일이 실제로 일어날 줄 알지 못 한 채 작업을 진행한다.  
많은 경우에 잠시 동안은 문제가 업슨 것처럼 보일 수 있다.  
그러나 나중에 프로그램이 잘못된 상태에 놓이거나, 이상한 값이 사용자에게 반환되어 심각한 상황을 초래할 수 있다.

> try catch (예외)로 로직을 구성하지 말라  
> https://rightnowdo.tistory.com/entry/JAVA-JAVA%EC%9D%98-%EC%98%88%EC%99%B8%EC%B2%98%EB%A6%AC-%EC%B2%98%EB%A6%AC%EC%97%90-%EB%8C%80%ED%95%9C-%EB%8B%A4%EC%96%91%ED%95%9C-%EA%B3%A0%EB%AF%BC  
> 변수를 가변으로 사용하지 말라. 변수는 불변으로 사용해야함  

## 1.3.3 코드를 오용하기 어렵게 만들라

자신이 작성한 코드에 잘못된 것들이 꽂히면, 모든 것이 폭발할 수 있다.  
시스템은 작동을 멈추고, 데이터베이스가 영구적으로 손상되거나, 중요한 데이터가 손실될 수 있다.

> 타입을 지원하지 않는, PHP 5.x 버전에서 많이 경험함  
> 코틀린에서도 Any 타입을 사용하지 않고, 상세한 타입으로 선언함  
> 레이어간 호출은 파라미터를 객체로 정의하는 것을 선호함

## 1.3.4 코드를 모듈화하라

코드를 위부에 의존하지 않고 실행할 수 있는 모듈로 나누는 것이 이로울 때가 많다.  
이때 두 개의 인접한 모듈 사이의 상호작용은 한 곳에서 일어나고 잘 정의된 인터페이스를 사용한다.  
이렇게 하면 변화하는 요구 사항에 더 쉽게 적응할 수 있는 코드를 작성하는 데 도움이 된다.  
왜냐하면 한 가지 기능을 변경한다고 해서 다른 부분까지 변경할 필요가 없기 때문인다.  

> SRP, OCP

## 1.3.5 코드를 재사용 가능하고 일반화할 수 있게 작성하라

- 재사용성
- 일반화성

> 정확한 차이를 이해하진 못 함  

## 1.3.6 테스트가 용이한 코드를 작성하고 제대로 테스트하라

- 버그나 동작하지 않는 코드를 배포되지 않도록 방지
- **소프트웨어 시스템과 코드베이스는 너무 크고 복잡해 한 사람이 모든 세부사항을 알 수 없음**  

- 테스트
  - 단위 테스트
  - 통합 테스트
  - End to End 테스트
- 테스트 용이성
  - SRP
