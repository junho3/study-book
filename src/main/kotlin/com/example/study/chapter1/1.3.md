# 1.3 코드 품질의 핵심 요소

1. 코드는 읽기 쉬워야 한다.
2. 코드는 예측 가능해야 한다.
3. 코드를 오용하기 어렵게 만들라.
4. 코드를 모듈화하라.
5. 코드를 재사용 카능하고 일반화할 수 있게 작성하라.
6. **테스트가 용이한 코드를 작성하고, 제대로 테스트하라.**

> 테스트가 용이한 코드를 작성하면, 1~5번을 해결할 수 있다고 생각함  

## 1.3.1 코드는 읽기 쉬워야 한다

1. 코드가 하는 일
2. 어떻게 그 일을 수행하는지
3. (입력이나 상태 등) 어떤 것을 필요로 하는지
4. 코드 실행 결과물

> 퍼블릭 메소드에서는 어떤 행위만 하는지 알 수 있도록  
> 프라이빗 메소드에서는 행위의 세부 구현  
> 코틀린의 object 클래스를 활용하여 helper 클래스를 만들고, 퍼블릭 메소드로 구현하기도 함. 단위테스트 코드를 작성하기 위함  
```
class CancelPaymentService
  fun cancelPayment(param: Param) {
      findPayment(param.paymentId) // 결제건 조회
          .also { validateStatus(it.status) } // 결제건 상태 유효성 검증
          .also { validateBalanceAmount(it.money, param.money) } // 잔액과 취소금액 유효성 검증
          
      val response = callKakaopay(param.toRequest()) // 카카오페이 호출. dto 변환은 Param에 위임
  }
  
  private validateStatus(status: Status) { ... }
  private validateBalanceMoney(balanceMoney: Long, cancelMoney: Long) { ... }
  private callKakaopay(request: KakaopayRequest): KakaopayResponse { ... }
}

object CancelPaymentServiceHelper {
  fun validateStatus(status: Status) { ... }
}
```

## 1.3.2 코드는 예측 가능해야한다

코드의 사용자는 그 코드에 의해 일어날 일을 예상하지 않고 있기 때문에 그 일이 실제로 일어날 줄 알지 못 한 채 작업을 진행한다.  
많은 경우에 잠시 동안은 문제가 업슨 것처럼 보일 수 있다.  
그러나 나중에 프로그램이 잘못된 상태에 놓이거나, 이상한 값이 사용자에게 반환되어 심각한 상황을 초래할 수 있다.

> try catch (예외)로 로직을 구성하지 말라  
> https://rightnowdo.tistory.com/entry/JAVA-JAVA%EC%9D%98-%EC%98%88%EC%99%B8%EC%B2%98%EB%A6%AC-%EC%B2%98%EB%A6%AC%EC%97%90-%EB%8C%80%ED%95%9C-%EB%8B%A4%EC%96%91%ED%95%9C-%EA%B3%A0%EB%AF%BC  
```
프로그래밍에서 예외를 로직의 일부로 사용하는 것은 일반적으로 권장되지 않습니다.  
이는 일반적으로 예외 처리 메커니즘이 코드의 가독성, 유지 보수성 및 디버깅을 어렵게 만들기 때문입니다.  
다음은 이러한 접근 방식이 권장되지 않는 이유에 대한 몇 가지 이유입니다:  
코드 읽기의 복잡성: 예외를 로직의 일부로 사용하면 코드의 의도를 파악하기 어려워집니다. 예외는 예기치 않은 상황이나 오류 처리를 위해 사용되어야 하며, 프로그램의 주요 흐름을 파악하는 데 방해가 될 수 있습니다.  
프로그램의 흐름 제어: 예외는 특정 상황에 대한 예외 처리를 위해 사용되어야 합니다. 예외를 로직의 일부로 사용하면 프로그램의 흐름을 예외의 발생과 처리 사이에서 제어하게 되어 로직을 복잡하게 만들고 예상치 못한 동작을 초래할 수 있습니다.  
성능 저하: 예외 처리는 비용이 많이 드는 작업입니다. 예외를 로직의 일부로 사용하면 예외 처리를 위한 추가적인 오버헤드가 발생하며, 프로그램의 성능이 저하될 수 있습니다.  
디버깅의 어려움: 예외가 로직의 일부로 사용되면 예외의 발생 원인을 찾기 어려울 수 있습니다. 코드의 어느 부분에서 예외가 발생했는지를 파악하기 어렵고, 디버깅 과정이 복잡해질 수 있습니다.  
따라서, 일반적으로 예외는 예기치 않은 상황이나 오류 처리를 위해 사용되어야 하며, 프로그램의 주요 로직과 분리되어야 합니다. 이를 통해 코드의 가독성과 유지 보수성을 향상시키고 예외 처리를 목적에 맞게 효과적으로 수행할 수 있습니다.  
```
> ChatGpt 답변  

> 변수를 가변으로 사용하지 말라. 변수는 불변으로 사용해야함  

## 1.3.3 코드를 오용하기 어렵게 만들라

자신이 작성한 코드에 잘못된 것들이 꽂히면, 모든 것이 폭발할 수 있다.  
시스템은 작동을 멈추고, 데이터베이스가 영구적으로 손상되거나, 중요한 데이터가 손실될 수 있다.

> 타입을 지원하지 않는, PHP 5.x 버전에서 많이 경험함  
> 코틀린에서도 Any 타입을 사용하지 않고, 상세한 타입으로 선언함  
> 레이어간 호출은 파라미터를 객체로 정의하는 것을 선호함

## 1.3.4 코드를 모듈화하라

코드를 위부에 의존하지 않고 실행할 수 있는 모듈로 나누는 것이 이로울 때가 많다.  
이때 두 개의 인접한 모듈 사이의 상호작용은 한 곳에서 일어나고 잘 정의된 인터페이스를 사용한다.  
이렇게 하면 변화하는 요구 사항에 더 쉽게 적응할 수 있는 코드를 작성하는 데 도움이 된다.  
왜냐하면 한 가지 기능을 변경한다고 해서 다른 부분까지 변경할 필요가 없기 때문인다.  

> SRP, OCP

## 1.3.5 코드를 재사용 가능하고 일반화할 수 있게 작성하라

- 재사용성
- 일반화성

> 정확한 차이를 이해하진 못 함  

## 1.3.6 테스트가 용이한 코드를 작성하고 제대로 테스트하라

- 버그나 동작하지 않는 코드를 배포되지 않도록 방지
- **소프트웨어 시스템과 코드베이스는 너무 크고 복잡해 한 사람이 모든 세부사항을 알 수 없음**  

- 테스트
  - 단위 테스트
  - 통합 테스트
  - End to End 테스트
- 테스트 용이성
  - SRP
