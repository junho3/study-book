# CHAPTER 9 아키텍처 실천

## 9.1 조직적 요인

### 9.1.1 콘웨이의 법칙

사회적 구조, 사람들 사이의 의사소통 경로가 최종 제품 설계에 필연적으로 영향을 미친다는 개념을 제시했다.  

콘웨이에 따르면 하나의 큰 문제를 작게 나누어 위임하면 각각을 조정하는 문제가 다시 발생한다.  
계층 아키텍처는 사용자 인터페이스, 비즈니스 로직 등의 기술적 기능을 기준으로 계층을 나눈다.  
그러나 이 구조에서 여러 계층을 수직으로 관통하는 공통 요건을 처리하면 오히려 조정 오버헤드가 증가한다.  

콘웨이는 소프트웨어 아키텍트가 아키텍처 설계 이외의 측면에 주의를 기울여야 한다고 강조하고 있다.  
위임, 할당, 팀 간 조정 등의 사안은 설계만큼이나 아키텍트에게 중요하다.  

콘웨이가 지적한 대로 위임 영역이 분할되고 담당 범위가 좁아질 때마다 효과적인 설계 대안은 줄어든다.  
바꿔 말하면, 누군가가 소유하고 있는 대상은 타인이 변경하기 매우 어렵다.  
그러므로, 소프트웨어 아키텍트는 작업을 분할하는 방식과 위임 범위를 항상 고민하고, 아키텍처의 목표와 팀 구조를 일치시키기 위해 노력해야 한다.  

마이크로서비스 아키텍처를 구축하는 회사는 대부분 기술적인 기준보다 서비스 경계를 기준으로 팀을 구성한다.  

도메인을 중심으로 구성된 팀은 기술 중심 팀보다 진화적 아키텍처를 구현하기 유리하다.  

> 안타깝지만 기존 조직 구성을 갈아엎는건 CEO급이 아니면 불가능하다고 생각 함  

#### 교차기능팀

도메인 중심 팀은 교차기능팀인 경우가 많다.  
즉, 한 팀의 구성원만으로 제품의 모든 영역을 아우를 수 있다.  
서비스 설계, 구현, 배포 등의 모든 역할을 하나의 팀이 담당하며, 운영처럼 전통적으로 분리되어 있던 역할까지 포괄한다.  

교차기능팀의 다양한 역할
- 아키텍처: 아키텍처는 증분 변경을 방해하는 부적절한 커플링을 제거해야 한다.  
- 비즈니스 분석가: 도메인 영역의 복잡도가 높은 제품은 비즈니스 규칙, 설정, 제품 이력 등의 특성도 복잡하다.  
- 데이터 
- 개발자: 개발자는 기존에 자신의 분야가 아니었던 작업도 처리할 수 있어야 한다.  
- 디자이너
- 운영
- 제품 관리자(PM)
- 테스트

교차기능팀의 목표 중 하나는 팀 조정 과정에서 발생하는 마찰을 근절하는 것이다.


##### 아마존의 피자 두 판 팀


#### 비즈니스 기능 중심 팀 구성

도메인을 중심으로 팀을 구성한다는 것은 비즈니스 기능을 중심으로 팀이 구성될 것임을 암시한다.  


#### 비즈니스 기능과 인지 부하의 균형

- 스트림 정렬팀: 비즈니스 도메인의 작업 흐름과 일치하는 팀
- 활성화팀: 새로운 기술/기법을 습득하도록 지원하는 팀
- 난해한 하위시스템팀: 비즈니스 도메인 중 수학/계산/기술 분야 담당
- 플랫폼팀: 스트림 정렬팀의 업무 속도를 가속시키기 위해 강력한 내부 도구를 생산하고 지원하는 팀  

팀을 설계할 때는 인지 부하를 반드시 함께 고려해야 한다.  


#### 프로젝트를 넘어 제품으로

> 카카오페이손해보험에 합류한 초반에는 드릴다운팀이 있었음  
> 비즈니스 개발을 위해 필요한 주제를 관심있는 사람 2~3명이 지원하여 POC를 담당  
> 취지는 좋지만 본업과 부업 사이에서 리소스 관리가 어렵고, 최종적으로 서비스를 인수인계 받는 팀에게는 낯선 개발(코드) 결과물을 받아야하는 문제가 있었음

따라서 개발자는 품질 지표에 주인의식을 느끼며 제품의 결함에 더욱 많은 관심을 기울인다.  

> 아직 팀을 리딩해본 경험은 없지만, 반드시 팀원이 하나의 서비스를 담당하는 분위기를 만들고자했음  
> 그것이 명목상일지라도 배포관리, 모니터링, 코드개선처럼 서비스에 대해 주인의식을 갖도록 하기 위함  


#### 과도한 팀 규모 지양

문제는 사람의 수가 아니라 사람들이 만들어내는 연결의 수다.  
폭증하는 의사소통 경로를 제한하려면 팀을 축소해야 하며, 축소된 팀은 교차기능팀이어야 한다.  


#### 팀 커플링 특성

팀 구조가 아키텍처 커플링 특성에 미치는 영향을 고려하지 않는 아키텍트가 많지만, 실제로는 막대한 영향을 미친다.  


### 9.1.2 문화

탁월한 아키텍트는 리더쉽을 발휘하며 기술 문화를 조성하고 개발자를 위해 시스템 구축 방식을 설계한다.  
또한 진화적 아키텍처 구축에 필요한 기술을 엔지니어에게 전수하고 장려한다.  

- 모든 팀 구성원이 피트니스 함수를 알고 있으며 새로운 도구나 제품이 피트니스 함수 제작 역량에 미치는 영향을 고려하고 있는가?  
- 피트니스 함수를 정의하고 시스템이 이를 얼마나 준수하고 있는지 측정하고 있는가?  
- 응집도, 커플링, 동조성을 엔지니어가 이해하고 있는가?
- 도메인과 어울리는 기술 개념에 대해 대화를 나누고 있는가?
- 배우고 싶은 기술이 아닌 변화에 적응하는 능력을 기준으로 솔루션을 선택하고 있는가?
- 비즈니스 변화에 팀은 어떻게 대응하고 있는가? 사소한 비즈니스 변화도 통합하기 어려워하거나 너무 많은 시간을 소비하고 있지는 않는가?

코드 리뷰는 현재의 코드가 향후 얼마나 변화에 잘 적응할지 자연스럽게 고민할 수 있는 지점이다.  

코드 품질과 진화성은 의식적으로 우선시하지 않는 한 간과될 가능성이 높다.  


### 9.1.3 실험 문화

조직은 다음과 같은 다양한 방법으로 실험을 장려할 수 있다.  
- 외부 아이디어 도입
- 명시적 개선 장려
- 스파이크 구현 및 안정화: 스파이크 솔루션의 목표는 우수한 설계가 아닌 빠른 학습 속도다.
- 혁신 시간 확보
- 집합 기반 개발: 효과적인 집합 기반 개발의 핵심은 짧은 시간동안 여러 방식으로 프로토타입을 제작하고 상세한 데이터와 경험을 얻는 것이다.
- 엔지니어와 최종 사용자 연결


### 9.1.4 CFO와 예산

아키텍처 퀀툼 수가 증가할 때 비용이 감소하는 이유는 다음과 같다.
1. 아키텍처를 구성하는 요소가 더 작아지므로 관심사가 더욱 명확하게 분리 및 정의된다.
2. 물리적인 퀀텀 수가 늘어나면 운영은 자동화로 대응해야 한다.

그러나 퀀텀이 지나치게 작아지면 퀀텀 수의 규모 자체가 비용을 유발하기 시작한다.  

공격적인 시장을 상대하는 기업은 기민하게 움직여야 하므로 작은 퀀텀이 적합하다.  
반대로, 단순함을 중요시하는 회사는 모놀리식 아키텍처를 구축하는 것이 더 실용적일 것이다.  


## 9.2 비즈니스 사례

아키텍트는 진화적 아키텍처가 불러올 변화와 함께 거버넌스 자동화에 대한 확신을 함께 심어줄 수 있어야 한다.  

아키텍트는 비즈니스 이해관계자가 이해하고 받아들일 수 있는 언어를 이용해 아키텍처의 개념을 설명할 수 있다.  


### 9.2.1 가설 주도 개발 및 데이터 주도 개발

데이터 주도 개발은 데이터를 중심으로 기술적 변화를 도모하는 개발 방법론이다.  
가설 주도 개발은 기술 측면의 관심사 대신 비즈니스를 통합한다.  

가설 주도 개발은 공식화된 요구 사항을 수집하고 애플리케이션 기능으로 구현하는 프로세스를 따르지 않는다.  
그 대신, 과학적인 방법론에 시간과 자원을 투입한다.  
먼저 실행 가능한 최소 제품 버전으로 애플리케이션을 만들고, 요구 사항이 아닌 가설에 근거해 새로운 기능을 추가한다.  

애자일 소프트웨어 방법론을 가동하는 엔진은 중첩된 피드백 순환이다.  
이러한 피드백은 테스트, 지속적 통합, 반복 수행을 통해 형성된다.  


### 9.2.2 실험적 매체로서의 피트니스 함수

#### 사례연구1 UDP 통신

피트니스 함수 실행 후, 메시지의 40%가 대규모로 손실되고 있음이 밝혀졌다.  

#### 사례연구2 보안 의존성

#### 사례연구3 동시 피트니스 함수

피트니스 함수를 실행한 결과, 평균 호출 건수가 초당 1,200건으로 예상을 크게 초과했음을 알게 되었다.  
따라서 팀은 확장 임계치를 현실적인 수준으로 갱신했다.  

#### 사례연구4 정확성 피트니스 함수

두 버전의 코드를 일정 비율에 따라 나란히 실행하며 차이점을 비교하고, 신기능이 구기능과 동일하게 작동하는지 검증한다.  

피트니스 함수가 낳은 또 다른 부수적인 효과가 있다.  
그간 명시되지 않았던 일부 유형의 데이터가 피트니스 함수를 통해 식별되었으며, 이를 통해 레거시 시스템의 데이터 의존성에 대한 전체적인 이해도를 높일 수 있었다.  


## 9.3 엔터프라이즈 피트니스 함수 구축
