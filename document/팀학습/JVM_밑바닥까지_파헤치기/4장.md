# 4장 가상 머신 성능 모니터링과 문제 해결 도구

## 4.1 들어가며

## 4.2 기본적인 문제 해결 도구

이 도구들은 라이선스와 성숙 수준에 따라 다음 세 범주로 나눌 수 있다.  
- 상용 인증 도구
- 공식 지원 도구
- 실험적 도구

도구들을 자바로 구현한 데는 이유가 있다.  
애플리케이션이 프로덕션 환경에 배포되면 서버에 물리적으로 직접 접근하거나 SSH 등으로 원격 접속하는 데 제약이 있을 수 있다.  
이럴 경우라도 개발자는 JDK 도구 라이브러리의 인터페이스와 구현 코드를 이용하여 강력한 모니터링과 분석 기능을 애플리케이션에서 직접 제공할 수 있다.  

대체로 상위 버전 JDK의 도구들은 하위 버전 JDK의 가상 머신에서 구동되는 프로그램과 호환되며 반대도 마찬가지다.  

### 4.2.1 jps: 가상 머신 프로세스 상태 도구

동작 중인 가상 머신 프로세스 목록을 보여 주며 각 프로세스에서 가상 머신이 실행한 메인 클래스의 이름과 로컬 가상 머신 식별자(LVMID)를 알려준다.  
대다수 다른 JDK 도구에서 모니터링할 가상 머신 프로세스를 명시하려면 LVMID를 알아야 하기 때문이다.  

로컬 가상 머신 프로세스의 LVMID 값은 운영 체제의 프로세스 아이디, 즉 PID와 같다.  

```
~ ❯ jps -l
1536 org.sonarsource.sonarlint.core.backend.cli.SonarLintServerCli
1846 jdk.jcmd/sun.tools.jps.Jps
1415 com.intellij.idea.Main
```

### 4.2.2 jstat: 가상 머신 통계 정보 모니터링 도구

- 로컬 또는 원격 가상 머신 프로세스의 클래스 로딩
- 메모리
- 가비지 컬렉션
- JIT 컴파일

```
~ ❯ jstat -gc 1415 250 20    
S0C         S1C         S0U         S1U          EC           EU           OC           OU          MC         MU       CCSC      CCSU     YGC     YGCT     FGC    FGCT     CGC    CGCT       GCT
0.0     10240.0         0.0      9600.3     296960.0      95232.0     331776.0     304067.9   341312.0   337079.5   42432.0   40606.8     57     0.760     0     0.000    36     0.348     1.108
```

jstat은 가상 머신 상태 정보를 텍스트로만 보여 주어 VisualVM이나 JMC처럼 시각적으로 보여 주는 모니터링 도구보다 직관적이지 않다.  

### 4.2.3 jinfo: 자바 설정 정보 도구

jinfo는 가상 머신의 다양한 매개 변수를 실시간으로 확인하고 변경하는 도구다.  

```
~ ❯ jinfo -flag ConcGCThreads 1415
-XX:ConcGCThreads=2
```

### 4.2.4 jmap: 자바 메모리 매핑 도구

jmap은 힙 스냅숏을 파일로 덤프해 주는 자바용 메모리 맵 명령어다.  
힙 스냅숏 덤프 외에도 jmap으로 F-큐, 자바 힙과 메서드 영역 상세 정보도 알아낼 수 있다.  

```
~ ❯ jmap -histo 1415
```

### 4.2.5 jhat: 가상 머신 힙 덤프 스냅숏 분석 도구

jhat은 JDK 8까지 제공되던 JVM 힙 분석 도구로, jmap으로 덤프한 힙 스냅숏을 분석할 수 있다.  
JDK 9부터 jhsdb가 그 자리를 대신한다.  

실무에서 jhat을 직접 사용해 분석하는 사람은 많지 않다.  
- 힙 스냅숏 덤프를 애플리케이션이 배포된 서버에서 직접 분석하는 일은 드물다.
- jhat의 분석 기능은 단순한 편이다.  

### 4.2.6 jstack: 자바 스택 추적 도구

jstack은 현재 가상 머신의 스레드 스냅숏을 생성하는 데 쓰인다.  
스레드 스냅숏은 현재 가상 머신에서 실행 중인 각 스레드의 메서드 스택들의 집합이다.  
주로 스레드가 장시간 멈춰 있을 때 원인을 찾기 위해 생성한다.  

```
~ ❯ jstack -l 1415
```

### 4.2.7 기본 도구 요약


## 4.3 GUI 도구



