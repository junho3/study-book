# 9장 다른 문제들

## 9-1 스플릿-브레인이 가장 큰 위험이다

스플릿-브레인이 똑같은 복제 토폴로지에서 동시에 발생하려면 2가지 조건을 만족해야 합니다.  
- 둘 이상의 MySQL 인스턴스에서 쓰기가 가능합니다. (read_only = 0)  
- 둘 이상의 MySQL 인스턴스에서 쓰기가 발생합니다.

일관되지 않은 데이터는 근본적으로 잘못되었을 뿐만 아니라 복제에 문제가 생기거나 심지어는 이 때문에 더 많은 데이터가 일관되지 않게 되어 다음 문제는 데이터 드리프트가 발생할 수 있습니다.  

스플릿-브레인을 중지하려면 모든 인스턴스에서 쓰기를 비활성화합니다.  
하나의 인스턴스만 쓰기 가능 상태로 두지 마세요.  
그러면 문제가 더 나빠집니다.  
쓰기를 비활성화할 수 없으면 MySQL이나 서버 종료를 심각하게 고려해야 합니다.  

잠재적으로 잘못된 데이터를 일겅도 더 이상의 손상이 발생하지 않는다고 확신한다면 `super_read_only`모드를 사용하여 데이터를 수정하는 동안 MySQL을 읽기 전용 모드(read_only = 1)로 실행할 수 있습니다.  

일치하지 않는 행을 찾는 방법은 `pt-table-sync`를 실행하거나 수동으로 확인하는 두 가지뿐입니다.  


## 9-2 데이터 드리프트는 실제지만 보이지 않는다

데이터 드리프트는 일관성 없는 데이터를 의미합니다.  
하나 이상의 행이 같은 복제 토폴로지의 서로 다른 MySQL 인스턴스에서 서로 다른 값을 가집니다.  

엔지니어와 DBA 모두 데이터 드리프트를 유발하거나 허용하기 위해 수행된 작업이 없다고 확신합니다.  
그럼에도 불구하고 데이터 드리프트는 존재합니다.  


## 9-3 ORM을 믿지 않도록 주의한다.  

ORM은 본질적으로 나쁘거나 비효율적이지는 않지만 성능이 목적이 아니므로 ORM 라이브러리에서 생성된 쿼리를 확인해야 합니다.  
ORM은 행을 객체로 취급하기 때문에 ORM 라이브러리는 모든 열을 선택할 수 있습니다.  


## 9-4 스키마는 항상 변경된다.  

온라인 스키마 변경을 수행하는 것은 도전적입니다.  
사용 중인 스키마를 애플리케이션에 영향을 주지 않고 변경하는 것입니다.  

- pt-online-schema-changes
- gh-ost
- ALTER TABLE


## 9-5 MySQL 표준 SQL 확장

MySQL은 전체 외부 조인과 같은 일부 표준 SQL 기능을 지원하지 않습니다.  


## 9-6 시끄러운 이웃들

물리적 서버에서 이른바 '시끄러운 이웃'은 지나치게 많은 시스템 리소스를 사용하여 다른 프로그램의 성능을 떨어뜨리는 프로그램입니다.  

클라우드에서는 시끄러운 이웃의 존재를 보거나 증명할 수 없습니다.  
보안을 위해 클라우드 공급자는 공유 서버에서 테넌트를 엄격하게 분리합니다.  
따라서 시끄러운 이웃이 의심될 때는 클라우드 데이터베이스를 다시 프로비저닝하는 것이 일반적입니다.  

> 의심되는 ec2는 서버를 제거했다가 다시 붙인(생성) 기억이 있음


## 9-7 애플리케이션은 우아하게 실패하지 않는다

- MySQL이 오프라인 상태입니다.
- MySQL은 응답 속도가 매우 느립니다.
- MySQL은 읽기 전용입니다.
- MySQL이 방금 시작했습니다.
- 읽기 전용 복제본이 오프라인이거나 매우 느립니다.
- 같은 지역에서 장애 조치가 되었습니다.
- 다른 지역으로 장애 조치가 되었습니다.
- 데이터베이스 백업이 실행 중입니다.
- DNS 주소 해석이 매우 느립니다.
- 네트워크가 느리거나 꽉 찼습니다.
- RAID 배열에 있는 하나의 하드 드라이브가 성능이 저하되었습니다.
- SSD의 여유 디스크 공간이 5% 미만입니다.


## 9-8 고성능 MySQL은 어렵다

결과적으로 이 책에서 배운 내용을 애플리케이션에 적용하기 시작하면 다음 2가지 문제에 직면할 수 있습니다.  

첫 번째 문제는 실제 애플리케이션 쿼리가 이 책에 있는 간단한 예보다 일반적으로 더 복잡합니다.  

두 번째 문제는 실제 애플리케이션 성능이 워크로드의 한쪽 측면에 거의 의존하지 않는다는 것입니다.  
MySQL에서 더 많은 성능이 필요할수록 전체 워크로드를 더 많이 최적화해야 합니다.  



