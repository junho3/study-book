# 10장 알림 시스템 설계

## 1단계 문제 이해 및 설계 범위 확정

- 푸시 알림, SMS, 이메일 
- 연성 실시간
- iOS, 안드로이드, PC
- 클라이언트 애플리케이션 프로그램 / 서버 스케줄링
- 알림을 받지 않도록 설정 가능
- 모바일 푸시 알림 1,000만건, SMS 100만건, 이메일 500만건

## 2단계 개략적 설계안 제시 및 동의 구하기

### iOS 푸시 알림

알림 제공자 > APNS > iOS 단말

- 알림 제공자: 단말 토큰과 페이로드를 APNS 호출
- APNS: 애플이 제공하는 원격 서비스

#### 안드로이드 푸시 알림

알림 제공자 > FCM > 안드로이드 단말

#### SMS 메시지

알림 제공자 > SMS 서비스(인포뱅크) > SMS 수신 단말

#### 이메일

알림 제공자 > 이메일 서비스 > 이메일 수신 단말

### 연락처 정보 수집 절차

### 알림 전송 및 수신 절차

#### 개략적 설계안 (초안)

하나의 알림 시스템에서 처리하는 구조

- SPOF
- 확장성 제한
- 성능 병목

> 초기 컬리 알림 서비스 모델 구조  
> 내부 도메인 서비스 > 내부 메세지 API > 알림톡 DB < 외부 솔루션  
> 솔루션에서 안내한 알림톡용 DB 테이블에 데이터를 인서트하면 솔루션이 알아서 처리함   

#### 개략적 설계안 (개선된 버전)

알림톡을 발송하는 서버를 분리하고, 큐를 사용하여 스로틀링을 조절함

> 이후 컬리 알림 서비스 모델 구조  
> 내부 도메인 서비스 > 내부 메세지 API > 카프카 < 내부 메세지 컨슈머 > 외부 메세지 API  
> 내부 메세지 서비스에서 두 곳의 외부 메세지 API를 균등하게 호출  

## 3단계 상세 설계

### 안정성

#### 데이터 손실 방지

#### 알림 중복 전송 방지

> inbox, outbox 패턴

### 추가로 필요한 컴포넌트 및 고려사항

#### 알림 템플릿

#### 알림 설정

#### 전송률 제한

#### 재시도 방법

#### 푸시 알림과 보안

#### 큐 모니터링

#### 이벤트 추적

## 4단계 마무리


