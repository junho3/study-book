# 02 일반적인 시스템 설계 면접 흐름

- QPS, P99 같은 기능적 요구사항과 비기능적 요구사항 구분
- 모든 것은 트레이드오프
- 면접을 주도
- 시간
- 로깅, 모니터링, 경보
- 디버깅, 복잡성, 보안
- 전체 시스템과 모든 구성 요소의 성능 저하와 실패 고려
- 시스템 다이어그램, 순서도, 시퀀스 작성
- 시스템 향상 논의

## 2.1 요구사항 명확화와 트레이드오프 논의

면접 중 가장 먼저 체크해야 할 항목은 질문의 요구사항을 명확히 파악하는 것이다.  

필요한 것은 비판적 사고, 세부 사항에 대한 관심, 겸손함, 배우고자 하는 의지를 보여주는 것이다.  

## 2.2 API 명세 초안 작성

엔드포인트를 작성하기 전에 미리 기능적 요구사항을 명확히 해야한다.  

### 2.2.1 공통 API 엔드포인트

#### 상태 확인

GET /health

#### 회원가입과 로그인(인증)

#### 사용자와 콘텐츠 관리


## 2.3 사용자와 데이터 간의 연결과 처리

사용자와 데이터 간의 연결을 나타내고 다양한 시스템 구성 요소와 그 사이에서 발생하는 데이터 처리를 설명하는 다이어그램을 그릴 수 있다.  

## 2.4 데이터 모델 설계

데이터 모델을 처음부터 설계할지, 아니면 기존 데이터베이스를 사용할지 논의해야 한다.  

### 2.4.1 데이터베이스를 공유하는 여러 서비스의 단점의 예

주문 팀이 낮은 쓰기 지연 시간을 활용학 ㅣ위해 주문 테이블을 카산드라로 이동하고, 지표 서비스는 단순성과 낮은 쓰기 빈도 때문에 계속 SQL을 사용하려고 한다면 서비스는 더 이상 같은 데이터베이스를 공유할 수 없다.  

### 2.4.2 동시 사용자 업데이트 충돌을 방지하는 기법

SQL 테이블에 'unix_locked'라는 타임스탬프 열을 추가할 수 있다.  


## 2.5 로깅, 모니터링, 경보

### 2.5.1 모니터링의 중요성

### 2.5.2 관찰 가능성

- 지연 시간
- 트래픽
- 오류
- 포화

조용한 실패를 해결하는 방법도 논의해야 한다.  
4xx나 5xx여야 하는데, 2xx로 표시되거나 서비스에 로깅과 모니터링 개선이 필요함을 나타내는 것일 수 있다.  

### 2.5.3 경보 대응

온콜 엔지니어가 특정 경보의 원인을 잘 알지 못 할 수 있으므로 경보 목록, 발생 가능한 원인, 원인을 찾고 해결하는 절차가 포함된 런북을 준비해야 한다.  
자동화된 실패 복구를 구현하지 않는 것은 런북 남용이다.  

장애가 해결된 후에는 무엇이 잘못됐는지, 왜 그랬는지, 팀이 어떻게 재발을 방지할 것인지를 식별하는 사후 분석을 작성해야 한다.  

### 2.5.4 애플리케이션 수준 로깅 툴

- 프로메테우스 + 그라파나
- 센수
- 나기오스
- 자비스
- 스플렁크
- 데이터독
- 뉴렐릭

### 2.5.5 데이터 품질에 대한 스트리밍과 배치 검사

### 2.5.6 데이터 이상 탐지

### 2.5.7 무감지 오류와 감사

### 2.5.8 관찰 가능성 추가 자료


## 2.6 검색창

### 2.6.1 소개

검색을 구현하는 일반적인 기법

- WHERE column LIKE '%keyword%'
- match-sorter 라이브러리
- 엘라스틱서치

### 2.6.2 일래스틱서치를 활용한 검색창 구현

`"fuzziness": "AUTO"`는 퍼지(근사) 매칭을 허용하기 위한 것으로, 검색어나 검색 결과에 철자 오류가 있는지 확인하는 등의 여러 사용 사례가 있다.  

### 2.6.3 일래스틱서치 인덱스와 수집

인덱스 생성 방식
- 주기적인 방식
- 이벤트 트리거 방식
- 벌크 API

인덱스의 매핑을 변경하는 방법
- 이전 인덱스 삭제
- 재인덱싱
  - 동기적으로 발생하므로 비용이 많이 듦

### 2.6.4 SQL 대신 일래스틱서치 사용하기

필드 컨텍스트에서 쿼리 절은 '이 문서가 이 쿼리 절과 일치하는가?'라는 질문에 답한다.  
쿼리 컨텍스트에서 쿼리 절은 '이 문서가 이 쿼리 절과 얼마나 잘 일치하는가?'라는 질문에 답한다.  

SQL 대신 일래스틱서치를 사용하면 검색과 쿼리를 모두 할 수 있고, 중복 저장 요구사항을 제거하며, SQL 데이터베이스의 유지보수 부담을 없앨 수 있다.  
데이터 저장에 일래스틱서치만 사용하는 서비스를 본 적이 있다.  
SQL과 달리 CQRS나 ACID를 제공하지 않는다.  

### 2.6.5 서비스에서 검색 구현하기

면접에서 사용자 스토리와 기능 요구사항을 논의할 때 검색을 언급하는 것은 고객 중심적인 접근 자세를 보여주는 것이다.  

### 2.6.6 검색에 관한 추가 자료


## 2.7 기타 논의 가능한 주제

### 2.7.1 애플리케이션 유지보수와 확장

- 어떤 시스템 구성 요소가 기술에 의존하는가? 
- 어떤 것이 가장 빠르게 개발되고 가장 많은 유지보수 작업이 필요한가?
- 향후 필요하지 않을 수 있는 기능은 무엇인가?
- 어떻게 점진적으로 폐기하고 해체할 것인가?
- 이 과정에서 적절한 수준의 사용자 지원은 무엇이며 이를 어떻게 제공할 수 있을까?

### 2.7.2 다른 유형의 사용자 지원


### 2.7.3 대안적 아키텍처 결정


### 2.7.4 사용성과 피드백

사용성은 사용자가 원하는 목표를 효과적이고 효율적으로 달성하기 위해 시스템을 얼마나 잘 사용할 수 있는지를 측정하는 지표다.  

사용성은 사용자 설문조사로도 측정할 수 있다.  

### 2.7.5 에지 케이스와 새로운 제약 조건

이를 충족하기 위한 트레이드오프와 현재 요구사항과 새로운 요구사항을 모두 지원하게 아키텍처를 재설계할 수 있는지 논의할 수 있다.  

- 새로운 기능적 요구사항
- 확장성과 성능
- 지연 시간과 처리량
- 가용성과 내결함성
- 비용

### 2.7.6 클라우드 네이티브 개념


## 2.8 면접 후 회고와 평가

### 2.8.1 면접 직후 회고록 작성하기

면접이 끝날 때 자신의 다이어그램 사진 촬영에 대한 허락을 정중히 요청하되, 거절하더라도 끝까지 버티지 말아야 한다.  

면접 직후 아직 많은 세부 사항을 기억할 수 있을 때 가능한 한 빨리 회고록을 작성해야 한다.  

1. 머리글
2. 면접을 대략 10분 단위로 나눈다.
3. 기억할 수 있는 세부 사항을 채워 넣는다.
4. 개인적인 평가와 회고를 작성한다.
5. 향후 며칠 동안 더 많은 세부 사항이 기억난다면 이를 별도 항목으로 추가하여 원래 회고록에 적은 내용에 부정확성을 실수로 도입하지 않게 한다.

### 2.8.2 평가 작성하기

### 2.8.3 언급하지 않은 세부 사항

- 현재 지식을 기반으로 어떤 다른 세부사항을 추가할 수 있다고 생각하는가?
- 왜 면접 중에 언급하지 않았는가?
- 그 세부 사항이 관련이 없거나 낮은 수준이라고 생각했는가?

항상 상황을 객관적으로 바라보는 것을 잊지 말자.  

어떤 세부 사항이 틀렸을 것 같은가?  
이는 당신이 그 개념에 익숙하지 않다는 뜻이다.  
조사하고 이러한 개념에 관해 더 많이 공부하라.  

- 질문 명확화
- 지적인 질문을 했는가?
- 고수준 아키텍처가 요구사항을 얼마나 잘 다뤘는가?
- 무엇을 이해하지 못했는가?

### 2.8.4 면접 피드백


## 2.9 회사 면접하기

면접 전에 회사의 엔지니어링 블로그를 읽어보고 다음 사항을 더 잘 이해해야 한다.  

예비 관리자의 기술적 배경을 특히 비판적으로 평가해야 한다.  

전반적으로 앞으로 4년 동안 이 회사에서 무엇을 배울 수 있고 무엇을 배울 수 없는가?  
